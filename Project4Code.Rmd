---
title: "Project 4: Bank Marketing"
date: "January 5th 2020"
output: html_document
---

## Overview


This document contains instructions on Project 4 for STA 207 in Winter 2020. This document is made with `R markdown`. The `rmd` file to generate this document is available on the course website. 

## Background

A Portuguese retail bank started a telemarketing campaign in 2008, aiming to subscribe new users to a long-term deposit. Information collected during the campaign was recorded in this data set. More information is available on the UCI machine learning repository  ([link](https://archive.ics.uci.edu/ml/datasets/Bank+Marketing#)) and the citations therein. 

You are a consultant who is hired to study the retail banking market in Portugese. Somehow you come to know such a dataset is publicly available. Naturally, you want to gain some insights of the market from this dataset, before conducting an expensive survey. 

## Tasks 
```{r, warning = FALSE, message=FALSE}
library(ggplot2)
library(caret) # Accuracy
library(e1071)
library(rpart)
library(rpart.plot)
library(rattle)
library(randomForest)
library(caTools)
library(descr)
```
1.  Acquire the dataset from the UCI machine learning repository ([link](https://archive.ics.uci.edu/ml/datasets/Bank+Marketing#)). 

```{r,cache = TRUE}
library(data.table)
temp <- tempfile()
download.file('https://archive.ics.uci.edu/ml/machine-learning-databases/00222/bank-additional.zip', temp)
data  <- data.table(read.table(unzip(zipfile = temp, 
                                     files = 'bank-additional/bank-additional-full.csv', 
                                     junkpaths = TRUE), header = TRUE, sep = ';',
                               stringsAsFactors = FALSE))
#Using Local Dataset location
#data <- read.csv(file="./bank-additional-full.csv", header=TRUE, sep=",")
```
2.  Pick an appropriate data set to study, and justify your decision. 
```{r}
#summary of data
dim(data)
names(data)

# Check for any missing values:
sum(is.na(data))

#summary before cleaning
summary(data)
```

```{r}
#Analyzing barplots of variables
par(mfrow=c(2,2))
for(i in 1:(length(data)-1))
  {barplot(prop.table(table(data[[i]])) , 
           xlab=names(data)[i], ylab= "Frequency (%)" , col = rainbow(3))}
par(mfrow=c(1,1))
barplot(prop.table(table(data[[length(data)]])) , 
           xlab=names(data)[length(data)], ylab= "Frequency (%)" , col = rainbow(3))
```

3.  Explore this dataset and generate summary statistics (in forms of tables or plots) that you find crucial for your clients to know. 
4.  Build a predictive model for whether a client will sign on to a long-term deposit. You will use logistic regression in this task. Specifically, you will
    a.  write down a property logistic regression model,
    b.  fit the model,
    c.  evaluate the performance of the fitted model,
    d.  and conduct model diagnostic and/or sensitivity analysis. 
5.  Build another predictive model using random forest, and compare its performance compared to the logistic regression.

```{r}
#########################################################
# Sampling the dataset into training data and test data:
#############################################################
set.seed(2262)
sample <- sample.int(n = nrow(data), size = floor(.8*nrow(data)), replace = F)
traindata <- data[sample, ]
testdata  <- data[-sample, ]
```
```{r}
##########################################################
###   Implementing CART
#########################################################

# Classification and Regression Trees
bank.cart<-rpart(y ~ ., traindata , method = 'class')

par(mfrow=c(1,1))
fancyRpartPlot(bank.cart , digits=2 , palettes = c("Purples", "Oranges"))

#predict
cart_pred <- predict( bank.cart , testdata , type = "class")
cart_prob <- predict( bank.cart , testdata , type = "prob")

# Confusion matrix
confusionMatrix(as.factor(cart_pred) , factor(testdata$y))

### Cross table validation for CART
CrossTable(testdata$y, cart_pred,
           prop.chisq = FALSE, prop.c = FALSE, prop.r = FALSE,
           dnn = c('actual default', 'predicted default'))
```
```{r}
#########################
#Implementing C5.0
###########################
#install.packages("C50")
library(C50)
bank.c50 <- C5.0(factor(y) ~ . , traindata , trials=15)
bank.c50.pred<-predict(bank.c50,testdata,type="class" )
bank.c50.prob<-predict(bank.c50,testdata,type="prob" )
# Confusion matrix
confusionMatrix(as.factor(bank.c50.pred), as.factor(testdata$y))

### Cross table validation for random forest
CrossTable(testdata$y, bank.c50.pred,
           prop.chisq = FALSE, prop.c = FALSE, prop.r = FALSE,
           dnn = c('actual default', 'predicted default'))
```

6.  Explain the possible gap in the performances to your supervisor, who knows statistics quite well and only believes in data and mathematics.  
7.  Test whether having a house loan will increase the likelihood of a client to sign up for a long-term deposit. (Hint: you don't need to use the same model as in Task 4.)
8.  Explain your conclusion from the test to your clients who know little about statistics. 

In any of these tasks, if a statistical method is employed, you need to clearly state the model and justify your choice. 

